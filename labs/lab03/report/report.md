---
## Front matter
title: "Отчёт по лабораторной работе №3"
subtitle: "Анализ трафика в Wireshark"
author: "Авдадаев Джамал Геланиевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Изучение посредством Wireshark кадров Ethernet, анализ PDU протоколов транспортного и прикладного уровней стека TCP/IP.

# Выполнение задания

## Анализ кадров канального уровня в Wireshark

### Установка и запуск программы захвата трафика

В ходе выполнения лабораторной работы на домашнем устройстве была установлена программа Wireshark, после чего выбран активный сетевой интерфейс и запущен процесс захвата сетевого трафика. Для отображения только интересующих пакетов в строке фильтра был использован фильтр `arp or icmp`, позволяющий выделить кадры протоколов ARP и ICMP.

Перед началом анализа в консоли операционной системы с помощью команды ipconfig были определены IP-адрес устройства и адрес шлюза по умолчанию. Далее для генерации сетевого трафика был выполнен эхо-запрос к шлюзу.

### Проверка доступности шлюза и удалённых узлов

С целью генерации ICMP-трафика была выполнена серия эхо-запросов к шлюзу по умолчанию, а также к внешним сетевым ресурсам.

![Результаты выполнения команды ping](Screenshot_4.png)

В результате:
- при обращении к адресу шлюза ответы приходят без потерь;
- при обращении к одному из внешних ресурсов наблюдается отсутствие ответов;
- при обращении к другому доменному имени ответы успешно получены, что подтверждает работоспособность сетевого соединения и прохождение ICMP-пакетов через шлюз.

### Анализ ICMP-кадра (эхо-запрос)

После выполнения команды ping в Wireshark были отфильтрованы ICMP-пакеты. В верхней панели списка пакетов был выбран первый ICMP-кадр — эхо-запрос.

![ICMP Echo Request в Wireshark](Screenshot_1.png)

В результате анализа сведений о пакете установлено:

- длина кадра: 74 байта;
- тип кадра канального уровня: Ethernet II;
- MAC-адрес источника: MAC-адрес локального устройства;
- MAC-адрес назначения: MAC-адрес шлюза по умолчанию;
- тип MAC-адресов: индивидуальные (unicast), так как кадр передаётся конкретному устройству.

В заголовке IPv4 указано, что пакет отправлен с локального IP-адреса на адрес шлюза. Протокол верхнего уровня — ICMP, тип сообщения — Echo Request.

### Анализ ICMP-кадра (эхо-ответ)

Далее был выбран следующий ICMP-кадр — ответ на эхо-запрос.

![ICMP Echo Reply в Wireshark](Screenshot_2.png)

В ходе анализа установлено:

- длина кадра: 74 байта;
- тип кадра: Ethernet II;
- MAC-адрес источника: MAC-адрес шлюза;
- MAC-адрес назначения: MAC-адрес локального устройства;
- тип MAC-адресов: индивидуальные (unicast).

### Анализ ARP-кадров

В процессе передачи ICMP-пакетов в Wireshark также фиксируются ARP-кадры, используемые для определения соответствия IP- и MAC-адресов.

![ARP-кадры в Wireshark](Screenshot_3.png)

В заголовке Ethernet II ARP-кадра можно наблюдать:

- MAC-адрес источника — адрес устройства, отправившего ARP-запрос;
- MAC-адрес назначения — широковещательный адрес (broadcast) при запросе или индивидуальный адрес при ответе;
- тип кадра: ARP (0x0806).

ARP-запрос передаётся широковещательно, поскольку устройство не знает MAC-адрес узла с указанным IP. В ответ ARP-reply направляется уже на конкретный MAC-адрес источника запроса.

### Анализ ICMP-трафика при обращении к удалённому узлу

После запуска нового процесса захвата трафика был выполнен эхо-запрос к удалённому доменному имени. В результате в Wireshark были зафиксированы ICMP-запросы и ответы между локальным узлом и удалённым IP-адресом.

![ICMP-трафик к удалённому узлу](Screenshot_5.png)

В выбранном кадре ICMP-запроса:

- MAC-адрес источника — адрес локального устройства;
- MAC-адрес назначения — MAC-адрес шлюза;
- тип MAC-адресов — индивидуальные (unicast), поскольку передача осуществляется через маршрутизатор.

В кадре ICMP-ответа:

![ICMP-ответ от удалённого узла](Screenshot_6.png)

- MAC-адрес источника — MAC-адрес шлюза;
- MAC-адрес назначения — MAC-адрес локального устройства;
- тип адресации — индивидуальная (unicast).

Это связано с тем, что при передаче пакетов за пределы локальной сети кадры на канальном уровне адресуются не конечному удалённому узлу, а ближайшему маршрутизатору (шлюзу).

### Дополнительный анализ ARP при обращении к внешним ресурсам

В процессе обмена трафиком также фиксируются дополнительные ARP-кадры, связанные с обновлением таблицы соответствия IP- и MAC-адресов.

![ARP-кадры при работе с внешними узлами](Screenshot_7.png)

В ARP-запросах MAC-адрес назначения является широковещательным, что указывает на поиск владельца IP-адреса. В ARP-ответах используется индивидуальная адресация, при которой конкретное устройство сообщает свой MAC-адрес инициатору запроса.

## Анализ протоколов транспортного уровня в Wireshark

### Захват HTTP-трафика и анализ TCP

В ходе выполнения работы был запущен Wireshark и выбран активный сетевой интерфейс. Для генерации HTTP-трафика в браузере был открыт сайт, работающий по протоколу HTTP, после чего в строке фильтра был применён фильтр `http`.

![HTTP-трафик в Wireshark](Screenshot_8.png)

В результате анализа захваченных пакетов были зафиксированы HTTP-запросы и ответы, передаваемые поверх протокола TCP. В выбранном пакете HTTP-запроса видно:

- передача данных осуществляется по TCP;
- порт источника — динамический клиентский порт;
- порт назначения — 80 (HTTP);
- установлен флаг PSH, ACK, указывающий на передачу данных в рамках установленного соединения;
- в полезной нагрузке содержится строка запроса GET.

![HTTP-ответ в Wireshark](Screenshot_9.png)

В ответном пакете сервера:

- источник — порт 80;
- назначение — клиентский порт;
- передаётся HTTP-ответ со статусом (например, 304 Not Modified);
- соединение уже установлено, поэтому используются только подтверждения ACK и передача данных.

### Анализ DNS-трафика и протокола UDP

Далее в строке фильтра был применён фильтр `dns` для анализа запросов доменных имён.

![DNS-запрос в Wireshark](Screenshot_10.png)

В выбранном пакете видно:

- протокол транспортного уровня — UDP;
- порт источника — динамический;
- порт назначения — 53;
- в полезной нагрузке содержится DNS-запрос на разрешение доменного имени.

![DNS-ответ в Wireshark](Screenshot_11.png)

В ответном пакете:

- источник — порт 53;
- назначение — клиентский порт;
- содержится DNS-ответ с информацией о сопоставлении доменного имени и IP-адреса;
- передача осуществляется без установления соединения, что характерно для UDP.

### Анализ протокола QUIC

В строке фильтра был применён фильтр `quic` для анализа современного транспортного протокола QUIC, используемого браузерами для защищённых соединений.

![QUIC-трафик в Wireshark](Screenshot_12.png)

В списке пакетов наблюдаются:

- обмен пакетами между клиентом и удалённым сервером;
- передача данных по UDP-порту 443;
- наличие зашифрованной полезной нагрузки (Protected Payload).

В деталях выбранного пакета видно:

- протокол QUIC работает поверх UDP;
- используется короткий или длинный заголовок;
- в процессе установления соединения выполняется обмен служебными пакетами handshake.

![Handshake QUIC в Wireshark](Screenshot_13.png)

На этапе установления соединения фиксируются пакеты типа Initial и Handshake, содержащие параметры соединения и криптографические данные. После завершения согласования начинается передача защищённых данных.

## Анализ handshake протокола TCP

### Установление TCP-соединения

Для анализа процедуры установки TCP-соединения был выполнен захват трафика при обращении к веб-сайту. В Wireshark были найдены пакеты с признаками начала соединения.

![Начало TCP-соединения](Screenshot_14.png)

Процесс установки соединения TCP включает три этапа (three-way handshake):

1. Клиент отправляет пакет SYN на сервер, инициируя соединение.
2. Сервер отвечает пакетом SYN-ACK, подтверждая готовность принять соединение.
3. Клиент отправляет пакет ACK, подтверждая получение ответа.

На этих этапах наблюдается изменение значений:

- номера последовательности (Sequence Number);
- номера подтверждения (Acknowledgment Number);
- установка соответствующих флагов SYN и ACK.

После завершения этого процесса соединение считается установленным и начинается передача данных.

![Передача данных после установки соединения](Screenshot_15.png)

Далее фиксируются пакеты передачи данных, подтверждения ACK и возможные повторные передачи сегментов, что обеспечивает надёжность доставки.

### Анализ графика потока TCP

Для наглядного анализа взаимодействия был открыт инструмент «График потока» в разделе «Статистика».

![График потока TCP](Screenshot_16.png)

На графике отображается:

- обмен пакетами между клиентом и несколькими удалёнными узлами;
- последовательность передачи данных;
- подтверждения получения сегментов;
- поддержание соединения с помощью служебных пакетов.

Из графика видно, как после установления соединения происходит регулярный обмен сегментами с подтверждениями, что демонстрирует работу механизма управления потоком и надёжной доставки данных в TCP.

# Заключение

В ходе выполнения лабораторной работы был выполнен захват и анализ сетевого трафика с использованием программы Wireshark на различных уровнях модели взаимодействия. Были исследованы кадры канального уровня, а также пакеты транспортного и прикладного уровней, что позволило на практике проследить процесс передачи данных в локальной сети и при обращении к внешним ресурсам.

В процессе работы был выполнен анализ ARP- и ICMP-трафика, изучены особенности формирования Ethernet-кадров, определены MAC-адреса источников и получателей, а также рассмотрены принципы широковещательной и индивидуальной адресации. Экспериментально подтверждено, что перед передачей данных в пределах локальной сети выполняется процедура ARP-разрешения, а при взаимодействии с удалёнными узлами кадры направляются на MAC-адрес шлюза по умолчанию.

Дополнительно были исследованы протоколы транспортного уровня. На примере HTTP-трафика рассмотрена передача данных по TCP, изучены структура сегментов и служебные флаги. На примере DNS-запросов проанализирована работа UDP и особенности обмена короткими сообщениями без установления соединения. Также был рассмотрен современный протокол QUIC, функционирующий поверх UDP и обеспечивающий защищённую передачу данных.

Отдельное внимание было уделено процессу установления TCP-соединения. На практике был проанализирован механизм трёхстороннего рукопожатия (SYN, SYN-ACK, ACK), а также изменение номеров последовательности и подтверждения. С использованием графика потока была наглядно изучена последовательность обмена сегментами между клиентом и сервером.

В результате выполнения работы были закреплены практические навыки захвата, фильтрации и анализа сетевого трафика, а также получено представление о взаимодействии протоколов различных уровней при передаче данных в компьютерных сетях.
