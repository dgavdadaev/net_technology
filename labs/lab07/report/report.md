---
## Front matter
title: "Отчёт по лабораторной работе №7"
subtitle: "Адресация IPv4 и IPv6. Настройка DHCP"
author: "Авдадаев Джамал Геланиевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Получение навыков настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6

# Выполнение задания

## Настройка DHCP в случае IPv4

В соответствии с заданием были запущены GNS3 VM и клиент GNS3, после чего создан новый проект. В рабочем пространстве размещены маршрутизатор VyOS, коммутатор и оконечное устройство VPCS. Соединение выполнено согласно заданной топологии: PC1 → sw-01 → gw-01.

Имена устройств были изменены в соответствии с требованиями задания:
- коммутатор — dgavdadaev-sw-01;
- маршрутизатор — dgavdadaev-gw-01;
- клиент — PC1-dgavdadaev.

Собранная топология представлена на рисунке 7.1.

![Топология сети в GNS3](Screenshot_1.png)

Для анализа работы протокола DHCP был включён захват трафика на соединении между коммутатором dgavdadaev-sw-01 и маршрутизатором dgavdadaev-gw-01. Захваченные пакеты в дальнейшем анализировались с использованием анализатора протоколов Wireshark.

После загрузки маршрутизатора выполнен вход в систему под стандартной учётной записью vyos. Далее маршрутизатор переведён в режим конфигурирования, где выполнена базовая системная настройка:
- задано имя устройства dgavdadaev-gw-01;
- задано доменное имя dgavdadaev.net;
- создан новый пользователь dgavdadaev с заданным паролем;
- отключено получение IP-адреса по DHCP на интерфейсе eth0;
- выполнена фиксация и сохранение конфигурации.

Фрагмент выполненной конфигурации представлен на рисунке ниже.

![Базовая системная настройка VyOS](Screenshot_2.png)

После повторного входа в систему под созданным пользователем был удалён пользователь vyos, установленный по умолчанию. Конфигурация после изменений сохранена.

На интерфейсе eth0 маршрутизатора настроен статический IPv4-адрес 10.0.0.1/24. Далее была выполнена настройка DHCP-сервера:
- создана разделяемая сеть dgavdadaev;
- задано доменное имя dgavdadaev.net;
- задан DNS-сервер 10.0.0.1;
- задан шлюз по умолчанию 10.0.0.1;
- настроен диапазон выдаваемых адресов 10.0.0.2–10.0.0.253.

Данные настройки обеспечивают автоматическое распределение адресов узлам в подсети 10.0.0.0/24.

![Настройка адресации и DHCP-сервера на VyOS](Screenshot_3.png)

На узле PC1-dgavdadaev выполнено получение сетевых параметров по DHCP с использованием режима декодирования. В результате клиенту был выдан IP-адрес 10.0.0.2/24.

Основные параметры, полученные клиентом:
- IP-адрес: 10.0.0.2;
- маска подсети: 255.255.255.0;
- шлюз по умолчанию: 10.0.0.1;
- DNS-сервер: 10.0.0.1;
- доменное имя: dgavdadaev.net;
- время аренды адреса: 86400 секунд (24 часа).

Тип DHCP-сообщения ACK подтверждает успешное завершение процедуры назначения адреса.

![Получение параметров по DHCP на VPCS](Screenshot_4.png)

После получения параметров выполнена проверка текущей конфигурации IPv4. Отображаемые данные подтверждают корректное получение адреса, шлюза и DNS-сервера. Дополнительно выполнена проверка доступности маршрутизатора, которая завершилась успешно, что свидетельствует о корректной работе сетевого взаимодействия.

![Проверка IPv4-параметров и ping маршрутизатора](Screenshot_5.png)

На маршрутизаторе выполнен просмотр статистики DHCP-сервера и списка выданных аренд. Из статистики следует, что из пула размером 252 адреса выдан один адрес, остальные остаются доступными.

В таблице аренд отображается активная запись для узла VPCS с IP-адресом 10.0.0.2 и соответствующим MAC-адресом. Также указано время начала и окончания аренды.

![Статистика DHCP-сервера и активные аренды](Screenshot_6.png)

В журнале работы DHCP-сервера зафиксированы все этапы процедуры назначения адреса:
- запуск службы DHCP;
- получение DHCPDISCOVER от клиента;
- отправка DHCPOFFER;
- получение DHCPREQUEST;
- отправка DHCPACK.

Данные записи подтверждают корректную и последовательную работу DHCP-сервера.

![Журнал работы DHCP-сервера](Screenshot_7.png)

В Wireshark проанализированы пакеты DHCP, захваченные между коммутатором и маршрутизатором. Зафиксирована стандартная последовательность обмена DORA (Discover, Offer, Request, ACK).

В деталях пакетов отображаются ключевые параметры:
- идентификатор транзакции;
- предлагаемый IP-адрес 10.0.0.2;
- адрес DHCP-сервера 10.0.0.1;
- маска подсети, шлюз, DNS-сервер;
- доменное имя и время аренды.

Анализ подтверждает корректную реализацию протокола DHCP и успешное автоматическое назначение сетевых параметров клиенту.

![Захваченные DHCP-пакеты и их расшифровка в Wireshark](Screenshot_8.png)

## Настройка DHCP в случае IPv6

В ранее созданном проекте GNS3 выполнено расширение сети в соответствии с заданной топологией. В рабочем пространстве дополнительно размещены два коммутатора и два оконечных узла, в том числе клиент **Kali Linux CLI**, поскольку VPCS не поддерживает протокол DHCPv6.

Имена устройств приведены в соответствие с требованиями задания:
- маршрутизатор — dgavdadaev-gw-01;
- коммутаторы — dgavdadaev-sw-01, dgavdadaev-sw-02, dgavdadaev-sw-03;
- клиенты — PC1-dgavdadaev, PC2-dgavdadaev, PC3-dgavdadaev.

Итоговая топология сети представлена на рисунке ниже.

![Расширенная топология сети с поддержкой IPv6](Screenshot_9.png)

Для анализа работы механизмов DHCPv6 и Router Advertisement был включён захват трафика на соединениях между маршрутизатором dgavdadaev-gw-01 и коммутаторами dgavdadaev-sw-02 и dgavdadaev-sw-03. Захваченный трафик в дальнейшем анализировался с использованием Wireshark.

На маршрутизаторе выполнен переход в режим конфигурирования и настроена IPv6-адресация интерфейсов:
- интерфейсу eth1 назначен адрес 2000::1/64;
- интерфейсу eth2 назначен адрес 2001::1/64.

Просмотр конфигурации интерфейсов подтвердил корректность назначения адресов. После этого изменения были зафиксированы и сохранены.

![Настройка IPv6-адресов на интерфейсах eth1 и eth2](Screenshot_10.png)

Для реализации Stateless DHCPv6 выполнена настройка объявлений маршрутизатора (Router Advertisements) на интерфейсе eth1. Был объявлен префикс 2000::/64 и установлен флаг other-config-flag, указывающий клиентам на необходимость получения дополнительных параметров конфигурации через DHCPv6.

Далее настроен DHCPv6-сервер:
- создана разделяемая сеть dgavdadaev-stateless;
- указана подсеть 2000::/64;
- заданы общие параметры (common-options), включающие DNS-сервер 2000::1 и доменное имя dgavdadaev.net.

Подсеть 2000::/64 используется исключительно для передачи параметров конфигурации, а не для выдачи IPv6-адресов, так как адреса формируются клиентами автоматически на основе Router Advertisement.

Конфигурация DHCPv6 и RA представлена на рисунке ниже.

![Конфигурация Router Advertisement и DHCPv6 Stateless](Screenshot_11.png)

![Конфигурация Router Advertisement и DHCPv6 Stateless](Screenshot_12.png)

На узле PC2-dgavdadaev (Kali Linux CLI) выполнена проверка сетевой конфигурации. В результате:
- интерфейс eth0 получил глобальный IPv6-адрес из префикса 2000::/64;
- также присутствует link-local адрес fe80::/64;
- в таблице маршрутизации отображается маршрут по умолчанию через link-local адрес маршрутизатора, полученный из RA.

Вывод конфигурации и таблицы маршрутов представлен на рисунке ниже.

![IPv6-адресация и таблица маршрутизации на PC2](Screenshot_13.png)

С узла PC2 выполнена проверка доступности маршрутизатора путём отправки ICMPv6 Echo Request на адрес 2000::1. Ответы получены успешно, что подтверждает корректную работу IPv6-адресации и механизмов Router Advertisement.

![Проверка доступности маршрутизатора по IPv6](Screenshot_14.png)

До получения параметров DHCPv6 в файле `/etc/resolv.conf` на узле PC2 отсутствовали DNS-серверы, полученные по IPv6, либо использовались параметры по умолчанию.

После запуска DHCPv6-клиента в режиме запроса только дополнительной информации (Stateless) узел получил DNS-сервер, заданный на маршрутизаторе. Это подтверждает корректную работу DHCPv6 Stateless для передачи неадресных параметров.

![Получение DNS-настроек по DHCPv6](Screenshot_15.png)

На узле PC2 выполнен запрос DHCPv6 с параметрами:
- использование DHCPv6;
- запрос только параметров конфигурации, без выдачи адреса;
- вывод подробной информации о процессе обмена.

В процессе обмена зафиксировано, что сервер не выдаёт IPv6-адрес (отсутствует IAADDR), что соответствует Stateless-режиму работы. При этом параметры DNS и доменного имени были успешно получены.

Несмотря на сообщения о невозможности получения адреса, IPv6-связность сохраняется, так как адрес был назначен ранее через SLAAC.

После завершения DHCPv6-обмена повторно выполнена проверка доступности маршрутизатора и просмотр файла `/etc/resolv.conf`. Связность по IPv6 сохраняется, а DNS-настройки корректно применены.

На маршрутизаторе выполнен просмотр выданных аренд DHCPv6. В выводе отсутствуют записи о выданных IPv6-адресах, что соответствует Stateless-режиму работы сервера, при котором адреса не распределяются и не учитываются в таблице аренд.

![Список аренд DHCPv6 на маршрутизаторе](Screenshot_16.png)

В Wireshark проанализированы захваченные пакеты DHCPv6 и ICMPv6. Зафиксирована следующая последовательность:
- обмен ICMPv6 Neighbor Solicitation и Neighbor Advertisement;
- получение Router Advertisement с префиксом 2000::/64;
- отправка DHCPv6 Solicit и Request от клиента;
- получение DHCPv6 Reply с параметрами common-options;
- отсутствие IAADDR в ответах DHCPv6, что подтверждает Stateless-конфигурацию;
- ICMPv6 сообщения Destination Unreachable (Port unreachable), возникающие после завершения DHCPv6-обмена и не влияющие на корректность работы сети.

Анализ подтверждает, что IPv6-адрес назначается клиенту с помощью SLAAC, а DHCPv6 используется исключительно для передачи дополнительных параметров конфигурации, таких как DNS-сервер и доменное имя.

![Анализ В Wireshark](Screenshot_17.png)

На интерфейсе eth2 настроены объявления маршрутизатора (Router Advertisements) с установкой флага managed-flag. Данный флаг указывает хостам на необходимость использования DHCPv6 в режиме с отслеживанием состояния для получения IPv6-адреса, а не только дополнительных параметров конфигурации.

Далее на маршрутизаторе была добавлена конфигурация DHCPv6-сервера:
- создана разделяемая сеть dgavdadaev-stateful;
- задана подсеть 2001::/64;
- настроен диапазон выдаваемых IPv6-адресов 2001::100 – 2001::199;
- задан DNS-сервер 2001::1;
- задано доменное имя dgavdadaev.net.

Таким образом, DHCPv6-сервер в данном сегменте выполняет полноценное распределение IPv6-адресов и ведёт учёт выданных аренд.

Конфигурация DHCPv6 Stateful на маршрутизаторе представлена на рисунке ниже.

![Настройка DHCPv6 Stateful и Router Advertisement на eth2](Screenshot_18.png)

После применения конфигурации выполнен просмотр информации о выданных адресах DHCPv6. В таблице аренд отображается активная запись, что подтверждает корректную работу DHCPv6-сервера в режиме с отслеживанием состояния.

В выводе указаны:
- выданный IPv6-адрес из диапазона 2001::100–2001::199;
- состояние аренды (active);
- время последнего взаимодействия клиента с сервером;
- время окончания аренды;
- идентификаторы клиента (IAID и DUID).

Данные о выданных арендах представлены на рисунке ниже.

![Список выданных DHCPv6-адресов на маршрутизаторе](Screenshot_19.png)

На узле PC3-dgavdadaev (Kali Linux CLI) выполнена проверка сетевой конфигурации до получения адреса по DHCPv6. На интерфейсе eth0 присутствовал только link-local IPv6-адрес fe80::/64, а в таблице маршрутизации отображался маршрут по умолчанию через link-local адрес маршрутизатора, полученный из Router Advertisement.

Настройки DNS на данном этапе отсутствовали либо использовались значения по умолчанию.

![Исходная IPv6-конфигурация узла PC3](Screenshot_20.png)

На узле PC3 выполнен запрос DHCPv6 в режиме Stateful. В процессе обмена узел успешно получил IPv6-адрес из настроенного диапазона 2001::100–2001::199.

После завершения процедуры:
- интерфейсу eth0 был назначен глобальный IPv6-адрес из подсети 2001::/64;
- маршрут по умолчанию сохранён через маршрутизатор dgavdadaev-gw-01;
- DNS-сервер и доменное имя были получены по DHCPv6.

Процесс получения адреса и итоговая конфигурация представлены на рисунке ниже.

![Получение IPv6-адреса по DHCPv6 Stateful на PC3](Screenshot_21.png)

После завершения DHCPv6-обмена выполнена повторная проверка сетевой конфигурации узла PC3:
- таблица маршрутизации содержит маршрут по умолчанию;
- DNS-настройки корректно применены;
- выполнена успешная проверка доступности маршрутизатора по IPv6 путём отправки ICMPv6 Echo Request на адрес 2001::1.

Результаты проверки подтверждают корректную работу DHCPv6 Stateful и IPv6-маршрутизации.

![Проверка маршрутизации, DNS и ping по IPv6](Screenshot_22.png)

В Wireshark проанализированы пакеты DHCPv6, захваченные на соединении между маршрутизатором и сегментом сети PC3. Зафиксирована стандартная последовательность обмена DHCPv6 Stateful:
- Solicit — запрос клиента на получение IPv6-адреса;
- Advertise — предложение адреса сервером;
- Request — подтверждение выбора адреса клиентом;
- Reply — окончательное назначение IPv6-адреса и передача параметров конфигурации.

В деталях пакетов DHCPv6 Reply присутствует IA_NA (Identity Association for Non-temporary Address), что подтверждает выдачу IPv6-адреса сервером. Также в ответе содержатся параметры DNS и идентификатор сервера (DUID).

Дополнительно наблюдаются ICMPv6-сообщения Destination Unreachable (Port unreachable), которые возникают после завершения DHCPv6-обмена и не влияют на корректность функционирования сети.

Фрагмент анализа трафика представлен на рисунке ниже.

![Анализ DHCPv6 Stateful в Wireshark](Screenshot_23.png)

В ходе выполнения задания подтверждено, что при использовании DHCPv6 Stateful:
- IPv6-адреса назначаются централизованно DHCPv6-сервером;
- сервер ведёт учёт активных аренд;
- клиенты получают как адреса, так и дополнительные параметры конфигурации;
- механизм Router Advertisement используется для указания клиентам способа автоконфигурации.

# Заключение

В ходе лабораторной работы была изучена и практически реализована настройка адресации IPv4 и IPv6 в среде моделирования GNS3 с использованием маршрутизатора VyOS. Была построена и расширена сетевая топология, выполнена базовая настройка сетевых устройств и организована автоматическая выдача сетевых параметров клиентам.

В рамках работы настроен DHCP-сервер для IPv4, а также реализованы два варианта конфигурации DHCPv6: без отслеживания состояния (Stateless) и с отслеживанием состояния (Stateful). На практике продемонстрированы различия между механизмами SLAAC, DHCPv6 Stateless и DHCPv6 Stateful, а также их совместное использование с Router Advertisement.

Проведён анализ работы протоколов DHCP и DHCPv6 с использованием захвата трафика в Wireshark, что позволило наглядно проследить последовательность обмена сообщениями и подтверждить корректность выдачи адресов и параметров конфигурации.

Полученные результаты подтверждают корректную работу настроенных сервисов и демонстрируют основные принципы автоматической конфигурации сетевых параметров в сетях IPv4 и IPv6.


