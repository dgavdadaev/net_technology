---
## Front matter
title: "Отчёт по лабораторной работе №8"
subtitle: "Адресация IPv4 и IPv6. Настройка маршрутизации"
author: "Авдадаев Джамал Геланиевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Изучение принципов маршрутизации в IPv4- и IPv6-сетях и принципов настройки сетевого оборудования.

# Выполнение задания

## Построение туннеля IPv6–IPv4

В ходе выполнения лабораторной работы в среде моделирования **GNS3** была построена сеть согласно заданной топологии, включающая три маршрутизатора **VyOS**, два Ethernet-коммутатора и два оконечных устройства типа **VPCS**.  
Устройства были переименованы в соответствии с требованиями задания с указанием имени учётной записи студента:

- маршрутизаторы: **msk-dgavdadaev-gw-01**, **msk-dgavdadaev-gw-02**, **msk-dgavdadaev-gw-03**;
- коммутаторы: **msk-dgavdadaev-sw-01**, **msk-dgavdadaev-sw-02**;
- оконечные устройства: **PC1-dgavdadaev**, **PC2-dgavdadaev**.

Между маршрутизаторами **msk-dgavdadaev-gw-01** и **msk-dgavdadaev-gw-03** был подключён анализатор трафика для последующего изучения обмена данными на уровне протоколов IPv4 и ICMP.

Сформированная топология сети представлена на рисунке ниже.

![Топология сети IPv6–IPv4](Screenshot_1.png)

### Назначение IPv6-адресов оконечным устройствам

После запуска узлов на оконечных устройствах **VPCS** были вручную настроены IPv6-адреса в соответствии с заданием.

На **PC1-dgavdadaev** был назначен глобальный IPv6-адрес **1000::a/64**, после чего конфигурация была сохранена командой `save`. Далее с помощью команды `show ipv6` была проверена корректность назначения адреса и наличие link-local адреса.

![Настройка IPv6 на PC1](Screenshot_2.png)

Аналогичным образом на **PC2-dgavdadaev** был настроен IPv6-адрес **1002::a/64**. После сохранения конфигурации также была выполнена проверка текущих IPv6-параметров.

![Настройка IPv6 на PC2](Screenshot_3.png)

Сообщение *«Hostname is too long (Maximum 12 characters)»*, выводимое при старте VPCS, связано с внутренними ограничениями эмулятора и не влияет на работу сети.

### Установка и первичная настройка маршрутизаторов VyOS

На всех маршрутизаторах была выполнена установка системы **VyOS**. После завершения диалога установки устройства были перезагружены.

Далее каждый маршрутизатор был переведён в режим конфигурирования, где было изменено имя устройства в соответствии с принятой схемой именования. После внесения изменений конфигурация была применена и сохранена.

На маршрутизаторе **msk-dgavdadaev-gw-01** были настроены следующие параметры:
- интерфейсу **eth0** назначен IPv6-адрес **1000::1/64** для связи с локальной сетью;
- интерфейсу **eth1** назначен IPv4-адрес **10.0.0.1/8** для соединения с маршрутизатором **gw-03**;
- включена рассылка Router Advertisement для префикса **1000::/64**.

![Конфигурация msk-dgavdadaev-gw-01](Screenshot_4.png)

На маршрутизаторе **msk-dgavdadaev-gw-02** была выполнена аналогичная настройка:
- интерфейс **eth0** получил IPv6-адрес **1002::1/64**;
- интерфейс **eth1** — IPv4-адрес **20.0.0.2/8**;
- включена рассылка Router Advertisement для сети **1002::/64**.

![Конфигурация msk-dgavdadaev-gw-02](Screenshot_5.png)

Маршрутизатор **msk-dgavdadaev-gw-03** выполняет роль транзитного IPv4-узла. На нём были настроены только IPv4-адреса:
- **eth0** — **10.0.0.2/8**;
- **eth1** — **20.0.0.1/8**.

![Конфигурация msk-dgavdadaev-gw-03](Screenshot_6.png)

### Проверка получения маршрутизатора по IPv6 на оконечных устройствах

После завершения настройки маршрутизаторов на оконечных устройствах была повторно выполнена команда `show ipv6`.  
В выводе команд отображаются link-local адреса маршрутизаторов, что подтверждает корректную работу механизма Router Advertisement и автоматическое обнаружение шлюза по умолчанию.

![Проверка IPv6 на PC1](Screenshot_7.png)

![Проверка IPv6 на PC2](Screenshot_8.png)

### Проверка связности и анализ трафика

С маршрутизатора **msk-dgavdadaev-gw-01** была выполнена проверка IPv4-связности:
- соединение с узлом **10.0.0.2** устанавливается успешно;
- попытки обмена ICMP-пакетами с адресами **20.0.0.1** и **20.0.0.2** завершаются ошибкой *Network is unreachable*.

![Проверка ping с gw-01](Screenshot_9.png)

Полученный результат объясняется отсутствием маршрутов к сети **20.0.0.0/8** на маршрутизаторе **msk-dgavdadaev-gw-01**. Маршрутизация между сегментами IPv4 в данной конфигурации не настроена, поэтому доступ возможен только в пределах непосредственно подключённой сети **10.0.0.0/8**.

Для подтверждения обмена данными был проанализирован трафик в анализаторе. В захваченных пакетах наблюдаются ICMP Echo Request и Echo Reply, а также ARP-запросы и ответы, используемые для определения MAC-адресов соседних узлов.

![Анализ ICMP и ARP трафика](Screenshot_10.png)

### Настройка динамической маршрутизации IPv4 (RIP)

На следующем этапе лабораторной работы была выполнена настройка динамической маршрутизации IPv4 с использованием протокола **RIP**. Протокол RIP был выбран для автоматического распространения информации о маршрутах между маршрутизаторами, соединяющими IPv4-сегменты сети.

На маршрутизаторе **msk-dgavdadaev-gw-01** в конфигурации протоколов был добавлен IPv4-сегмент **10.0.0.0/8**, соответствующий сети, напрямую подключённой к интерфейсу **eth1**. После внесения изменений конфигурация была применена и сохранена.

![Настройка RIP на msk-dgavdadaev-gw-01](Screenshot_11.png)

На маршрутизаторе **msk-dgavdadaev-gw-02** был настроен протокол RIP для сети **20.0.0.0/8**, связанной с интерфейсом **eth1**. После применения и сохранения конфигурации маршрутизатор начал обмен маршрутной информацией с соседними узлами.

![Настройка RIP на msk-dgavdadaev-gw-02](Screenshot_12.png)

Маршрутизатор **msk-dgavdadaev-gw-03**, выполняющий роль транзитного узла между двумя IPv4-сетями, был настроен на участие в протоколе RIP сразу для двух сетей:
- **10.0.0.0/8**;
- **20.0.0.0/8**.

Это позволило обеспечить распространение маршрутной информации между сегментами сети.

![Настройка RIP на msk-dgavdadaev-gw-03](Screenshot_13.png)

### Проверка маршрутизации IPv4

После завершения настройки динамической маршрутизации была повторно выполнена проверка связности с маршрутизатора **msk-dgavdadaev-gw-01**.

В результате выполнения ICMP-запросов было установлено:
- соединение с узлом **10.0.0.2** устанавливается успешно;
- соединение с узлом **20.0.0.1** также устанавливается успешно;
- узел **20.0.0.2** стал доступен, что свидетельствует о корректном распространении маршрутов по протоколу RIP.

![Проверка ping после настройки RIP](Screenshot_14.png)

Подтверждение доступности всех IPv4-сегментов указывает на успешную настройку динамической маршрутизации между маршрутизаторами.

### Анализ трафика протокола RIP и ICMP

Для подтверждения корректной работы протокола RIP и маршрутизации IPv4 был выполнен анализ трафика на соединении между маршрутизаторами **msk-dgavdadaev-gw-01** и **msk-dgavdadaev-gw-03**.

В захваченном трафике наблюдаются:
- пакеты **RIPv2**, передаваемые на мультикаст-адрес **224.0.0.9**, используемые для обмена маршрутной информацией;
- ICMP Echo Request и Echo Reply, подтверждающие успешную маршрутизацию пакетов между различными IPv4-сетями;
- ARP-запросы и ответы, обеспечивающие сопоставление IP- и MAC-адресов на канальном уровне.

![Анализ RIP и ICMP трафика](Screenshot_15.png)


### Настройка туннеля

На маршрутизаторе **msk-dgavdadaev-gw-01** был создан туннельный интерфейс **tun0** со следующими параметрами:
- тип инкапсуляции — **SIT**;
- IPv4-адрес источника — **10.0.0.1**;
- IPv4-адрес удалённого узла — **20.0.0.2**;
- IPv6-адрес туннельного интерфейса — **1001::1/64**.

После применения и сохранения конфигурации туннельный интерфейс был успешно активирован.

![Настройка туннеля на msk-dgavdadaev-gw-01](Screenshot_16.png)

На маршрутизаторе **msk-dgavdadaev-gw-02** была выполнена симметричная настройка туннеля **tun0**:
- тип инкапсуляции — **SIT**;
- IPv4-адрес источника — **20.0.0.2**;
- IPv4-адрес удалённого узла — **10.0.0.1**;
- IPv6-адрес туннельного интерфейса — **1001::2/64**.

Данная конфигурация обеспечивает логическое IPv6-соединение между двумя маршрутизаторами поверх IPv4-инфраструктуры.

![Настройка туннеля на msk-dgavdadaev-gw-02](Screenshot_17.png)

### Настройка статической маршрутизации IPv6

После создания туннеля была выполнена настройка статической маршрутизации IPv6 для обеспечения сквозной связности между IPv6-сегментами.

На маршрутизаторе **msk-dgavdadaev-gw-01** был добавлен маршрут к сети **1002::/64** с указанием следующего перехода через туннельный адрес **1001::2**.

![Статический IPv6-маршрут на msk-dgavdadaev-gw-01](Screenshot_18.png)

На маршрутизаторе **msk-dgavdadaev-gw-02** был настроен статический маршрут к сети **1000::/64** через следующий переход **1001::1**.

![Статический IPv6-маршрут на msk-dgavdadaev-gw-02](Screenshot_19.png)

### Проверка доступности оконечных устройств по IPv6

После завершения настройки туннеля и маршрутизации была подтверждена IPv6-доступность между оконечными устройствами.

С узла **PC1-dgavdadaev** была выполнена проверка связности с **PC2-dgavdadaev**. ICMPv6-запросы успешно достигали адреса **1002::a**, а трассировка показала прохождение пакетов через IPv6-шлюзы и туннельный интерфейс.

![Ping и traceroute с PC1](Screenshot_20.png)

Аналогичная проверка была выполнена с узла **PC2-dgavdadaev** в направлении **PC1-dgavdadaev**. Результаты подтверждают симметричную доступность IPv6-узлов.

![Ping и traceroute с PC2](Screenshot_21.png)

### Анализ прохождения пакетов по туннелю IPv6–IPv4

Для детального изучения работы туннеля был проанализирован трафик с использованием анализатора, подключённого к каналу между маршрутизаторами **msk-dgavdadaev-gw-01** и **msk-dgavdadaev-gw-03**.

В захваченном трафике наблюдается следующая картина:
- исходные IPv6-пакеты (ICMPv6 Echo Request / Echo Reply) между адресами **1000::a** и **1002::a**;
- инкапсуляция IPv6-пакетов внутрь IPv4-пакетов с протоколом **41**;
- в заголовке IPv4 указываются адреса **20.0.0.2** и **10.0.0.1**, соответствующие концам туннеля;
- полезная нагрузка IPv4-пакета содержит полный IPv6-заголовок и ICMPv6-сообщение.

![Общий вид трафика IPv6 через IPv4](Screenshot_22.png)

![Детализация инкапсуляции IPv6 в IPv4](Screenshot_23.png)

# Заключение

В ходе выполнения лабораторной работы была изучена и практически реализована технология взаимодействия сетей IPv4 и IPv6 с использованием туннелирования в среде моделирования **GNS3**. Была построена составная сетевая топология с несколькими маршрутизаторами **VyOS**, оконечными устройствами **VPCS** и Ethernet-коммутаторами, а также выполнена их корректная адресация и настройка в соответствии с заданием.

В процессе работы была настроена динамическая маршрутизация IPv4 с использованием протокола **RIP**, что обеспечило автоматическое распространение маршрутной информации между сегментами сети. После этого был создан туннель **IPv6-over-IPv4 (SIT)**, позволивший организовать логическое соединение между удалёнными IPv6-сетями поверх существующей IPv4-инфраструктуры. Для обеспечения связности IPv6-сегментов была дополнительно настроена статическая маршрутизация IPv6.

Проверка доступности оконечных устройств подтвердила корректность настройки туннеля и маршрутизации: ICMPv6-пакеты успешно передавались между узлами, а результаты трассировки показали прохождение трафика через туннельные интерфейсы. Анализ трафика с использованием **Wireshark** позволил наглядно проследить процесс инкапсуляции IPv6-пакетов в IPv4-пакеты с протоколом 41, а также подтвердить корректную работу протоколов **ARP**, **ICMP**, **ICMPv6** и **RIP**.
